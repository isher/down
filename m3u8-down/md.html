<!DOCTYPE html>
<html>
<head>
    <title>M3U8 Analyzer and Downloader</title>
</head>
<body>
    <h1>M3U8 Analyzer and Downloader</h1>
    
    <!-- 添加一个文本框，用于输入或粘贴m3u8链接 -->
    <textarea id="m3u8Links" rows="5" cols="50"></textarea>
    
    <!-- 添加一个按钮，触发分析和下载操作 -->
    <button onclick="analyzeAndDownload()">Analyze and Download</button>
    
    <!-- 添加一个区域，用于显示分析和下载的结果 -->
    <div id="result"></div>

    <script>
        function analyzeAndDownload() {
            // 获取文本框中的m3u8链接列表
            var m3u8Links = document.getElementById("m3u8Links").value;
            var linksArray = m3u8Links.split('\n');
            
            // 创建一个用于显示结果的HTML字符串
            var resultHtml = "";

            // 循环处理每个m3u8链接
            for (var i = 0; i < linksArray.length; i++) {
                var m3u8Url = linksArray[i].trim();
                if (m3u8Url === "") continue;

                // 发送HTTP请求获取m3u8内容
                var xhr = new XMLHttpRequest();
                xhr.open("GET", m3u8Url, false);
                xhr.send();
                
                if (xhr.status === 200) {
                    var m3u8Content = xhr.responseText;
                    var parser = new m3u8.Parser();
                    parser.push(m3u8Content);
                    parser.end();
                    
                    // 创建目录以保存ts文件
                    var folderName = "Playlist" + i;
                    resultHtml += "<p>Processing " + m3u8Url + "...</p>";
                    
                    for (var j = 0; j < parser.manifest.segments.length; j++) {
                        var tsUrl = new URL(parser.manifest.segments[j].uri, m3u8Url).href;
                        
                        // 发送HTTP请求下载并保存ts文件
                        var tsXhr = new XMLHttpRequest();
                        tsXhr.open("GET", tsUrl, false);
                        tsXhr.responseType = "blob";
                        tsXhr.send();
                        
                        if (tsXhr.status === 200) {
                            var blob = tsXhr.response;
                            var tsFileName = tsUrl.split('/').pop();
                            
                            // 创建一个临时链接以下载ts文件
                            var a = document.createElement("a");
                            a.href = URL.createObjectURL(blob);
                            a.download = tsFileName;
                            a.style.display = "none";
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            
                            resultHtml += "<p>Downloaded " + tsFileName + "</p>";
                        } else {
                            resultHtml += "<p>Failed to download " + tsUrl + "</p>";
                        }
                    }
                } else {
                    resultHtml += "<p>Failed to fetch m3u8 content from " + m3u8Url + "</p>";
                }
            }
            
            // 将结果显示在页面上
            document.getElementById("result").innerHTML = resultHtml;
        }
    </script>
</body>
</html>
